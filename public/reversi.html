<!doctype html>
<html lang="th">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reversi Game</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  </head>
  <body>
    <div class="board" id="board"></div>
    <h3>Turn: <span id="turn"></span></h3>
    <script type="module">
      const socket = io();

      function move(row, col) {
        console.log("move");
        socket.emit("button_pressed", row, col);
      }

      for (let i = 0; i < 8; i++) {
        for (let j = 0; j < 8; j++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.setAttribute("id", i * 8 + j);
          cell.addEventListener(
            "click",
            ((row, col) => {
              return () => move(row, col);
            })(i, j),
          );
          if ((i == 3 && j == 3) || (i == 4 && j == 4)) {
            const disc = document.createElement("div");
            disc.classList.add("black-disc");
            cell.appendChild(disc);
          } else if ((i == 3 && j == 4) || (i == 4 && j == 3)) {
            const disc = document.createElement("div");
            disc.classList.add("white-disc");
            cell.appendChild(disc);
          } else {
            const disc = document.createElement("div");
            cell.appendChild(disc);
          }
          board.appendChild(cell);
        }
      }

      socket.on("turn_info", (turn) => {
        document.getElemenById("turn").innerHTML = color;
      });

      socket.on("updateGame", (mat) => {
        for (let i = 0; i < 8; i++) {
          for (let j = 0; j < 8; j++) {
            cell = document.getElementById(i * 8 + j).classList;
            if (mat[i][j] == "w") {
              cell.remove("black-disc", "white-disc");
              cell.add("white-disc");
            } else if (mat[i][j] == "b") {
              cell.remove("black-disc", "white-disc");
              cell.add("black-disc");
            } else {
              cell.remove("black-disc", "white-disc");
            }
          }
        }
      });

      socket.on("gameover", (res) => {
        window.location.href = window.location.href.replace("game", "result");
      });
    </script>
  </body>
</html>
